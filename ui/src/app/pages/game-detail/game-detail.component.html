<app-breadcrumb></app-breadcrumb>

<h1>{{ isEditMode ? 'Update Game' : 'Create Game' }}</h1>

<div class="container">
    <form [formGroup]="gameForm" (ngSubmit)="submitForm()">
        <div class="form-row">
            <mat-form-field appearance="outline" class="wide-field">
                <mat-label>Game Date</mat-label>
                <input
                    matInput
                    [matDatepicker]="datePicker"
                    [formControl]="dateControl"
                    placeholder="Choose game date" />
                <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
                <mat-datepicker #datePicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline" class="wide-field">
                <mat-label>Game Time</mat-label>
                <input
                    matInput
                    [matTimepicker]="timePicker"
                    [formControl]="timeControl"
                    placeholder="Choose game time" />
                <mat-timepicker-toggle matSuffix [for]="timePicker"></mat-timepicker-toggle>
                <mat-timepicker #timePicker [interval]="'5m'"></mat-timepicker>
            </mat-form-field>

            <mat-error *ngIf="gameForm.hasError('outOfSeason')">
                Game must be within the season dates:
                {{ seasonStart | date: 'medium' }} â€“ {{ seasonEnd | date: 'medium' }}
            </mat-error>
        </div>

        <div class="form-row">
            <mat-form-field appearance="outline" class="wide-field">
                <mat-label>Home Team</mat-label>
                <mat-select formControlName="home_team_id">
                    <mat-option *ngFor="let team of teams" [value]="team.id">{{ team.name }}</mat-option>
                </mat-select>
                <mat-error *ngIf="gameForm.get('home_team_id')?.hasError('required')">
                    Home team is required
                </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="wide-field">
                <mat-label>Home Score</mat-label>
                <input matInput type="text" formControlName="home_score" placeholder="Enter home score" />
                <mat-error *ngIf="gameForm.get('home_score')?.hasError('required')">
                    Home score is required
                </mat-error>
                <mat-error
                    *ngIf="
                        gameForm.get('home_score')?.hasError('pattern') ||
                        gameForm.get('home_score')?.hasError('min')
                    ">
                    Enter a valid whole number (cannot be negative)
                </mat-error>
            </mat-form-field>
        </div>

        <div class="form-row">
            <mat-form-field appearance="outline" class="wide-field">
                <mat-label>Away Team</mat-label>
                <mat-select formControlName="away_team_id">
                    <mat-option *ngFor="let team of teams" [value]="team.id">{{ team.name }}</mat-option>
                </mat-select>
                <mat-error *ngIf="gameForm.get('away_team_id')?.hasError('required')">
                    Away team is required
                </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="wide-field">
                <mat-label>Away Score</mat-label>
                <input matInput type="text" formControlName="away_score" placeholder="Enter away score" />
                <mat-error *ngIf="gameForm.get('away_score')?.hasError('required')">
                    Away score is required
                </mat-error>
                <mat-error
                    *ngIf="
                        gameForm.get('away_score')?.hasError('pattern') ||
                        gameForm.get('away_score')?.hasError('min')
                    ">
                    Enter a valid whole number (cannot be negative)
                </mat-error>
            </mat-form-field>
        </div>

        <div class="form-row">
            <mat-form-field appearance="outline" class="wide-field">
                <mat-label>Round</mat-label>
                <mat-select formControlName="round">
                    <mat-option *ngFor="let round of rounds" [value]="round">Round {{ round }}</mat-option>
                </mat-select>
                <mat-error *ngIf="gameForm.get('round')?.hasError('required')">Round is required</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="wide-field">
                <mat-label>Status</mat-label>
                <mat-select formControlName="status">
                    <mat-option value="scheduled">Scheduled</mat-option>
                    <mat-option value="playing">Playing</mat-option>
                    <mat-option value="finished">Finished</mat-option>
                    <mat-option value="cancelled">Cancelled</mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <div class="actions">
            <button type="submit" mat-flat-button>SAVE</button>
            <button
                mat-stroked-button
                [routerLink]="['/admin/competitions', competitionId, 'seasons', seasonId, 'games']">
                CANCEL
            </button>
            <button *ngIf="isEditMode" type="button" mat-flat-button class="warn" (click)="confirmDelete()">
                DELETE
            </button>
        </div>
    </form>
</div>
